<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
	<meta http-equiv="content-type" content="text/html;charset=utf-8" />
	<meta name="viewport" content="initial-scale=1.0, user-scalable=yes" />
	<title>Calculateur du taux d’encadrement</title>
	<style>
		html {
			height: 100%;
		}

		body {
			margin: 0;
			padding: 0;
			border: 0;
		}

		h4 {
			margin: 5px;
		}

		h5 {
			margin: 5px;
		}
	</style>
</head>

<body>

	<script type="text/javascript">
		function validationChamps() {
			var nbDirecteurs = document.forms["FormQuotas"].elements["textfieldDirecteursSF"];
			var nbDirecteursStagiaire = document.forms["FormQuotas"].elements["textfieldDirecteursSFstagiaire"];
			var nbAnimateurs = document.forms["FormQuotas"].elements["textfieldAnimateursSF"];
			var nbAnimateursStagiaire = document.forms["FormQuotas"].elements["textfieldAnimateursSFstagiaire"];
			var nbNonQualifies = document.forms["FormQuotas"].elements["textfieldNonQualifies"];
			var nbJeunes = document.forms["FormQuotas"].elements["textfieldJeunes"];
			if (nbDirecteurs.value == "") {
				afficheResultat(false, "Merci de rentrer le nombre de personnes avec la qualification \"Directeur SF titulaire\"");
				nbDirecteurs.focus();
				return false;
			}
			if (nbDirecteursStagiaire.value == "") {
				afficheResultat(false, "Merci de rentrer le nombre de personnes avec la qualification \"Directeur SF stagiaire\"");
				nbDirecteursStagiaire.focus();
				return false;
			}
			if (nbAnimateurs.value == "") {
				afficheResultat(false, "Merci de rentrer le nombre de personnes avec la qualification \"Animateur SF titulaire\"");
				nbAnimateurs.focus();
				return false;
			}
			if (nbAnimateursStagiaire.value == "") {
				afficheResultat(false, "Merci de rentrer le nombre de personnes avec la qualification \"Animateur SF stagiaire\"");
				nbAnimateursStagiaire.focus();
				return false;
			}
			if (nbNonQualifies.value == "") {
				afficheResultat(false, "Merci de rentrer le nombre de personnes sans qualification");
				nbNonQualifies.focus();
				return false;
			}
			if (nbJeunes.value == "") {
				afficheResultat(false, "Merci de rentrer le nombre de jeunes");
				nbJeunes.focus();
				return false;
			}
			if (nbJeunes.value == "0") {
				afficheResultat(false, "Merci de rentrer le nombre de jeunes > 0");
				nbJeunes.focus();
				return false;
			}

			return true;
		}

		function afficheResultat($resultat, $detail) {
			var champResultat = document.forms["FormQuotas"].elements["labelResultat"];
			var champDetail = document.forms["FormQuotas"].elements["labelDetail"];

			champResultat.style.color = $resultat == true ? "green" : "red"
			champResultat.value = $resultat == true ? "Parfait" : "Pas bon";
			champDetail.value = $detail;
		}

		function calculQuotas() {
			var ret = validationChamps();
			if (ret == true) {
				var nbDirecteurs = document.forms["FormQuotas"].elements["textfieldDirecteursSF"].value;
				var nbDirecteursStagiaire = document.forms["FormQuotas"].elements["textfieldDirecteursSFstagiaire"].value;
				var nbAnimateurs = document.forms["FormQuotas"].elements["textfieldAnimateursSF"].value;
				var nbAnimateursStagiaire = document.forms["FormQuotas"].elements["textfieldAnimateursSFstagiaire"].value;
				var nbNonQualifies = document.forms["FormQuotas"].elements["textfieldNonQualifies"].value;
				var unite = document.forms["FormQuotas"].elements["radioUnite"].value;
				var nbJeunes = document.forms["FormQuotas"].elements["textfieldJeunes"].value;
				var pk = (unite.toString().indexOf("radioPionniersCaravelles") == 0);

				var effectifTotal = parseInt(nbDirecteurs, 10) + parseInt(nbDirecteursStagiaire, 10) + parseInt(nbAnimateurs, 10) + parseInt(nbAnimateursStagiaire, 10) + parseInt(nbNonQualifies, 10);

				if (pk == true) {
					// Calcul pour une unité pionniers et/ou caravelles
					var deltaDirSF = parseInt(nbDirecteurs, 10) + parseInt(nbDirecteursStagiaire, 10);
					if (deltaDirSF < 0) {
						afficheResultat(false, "Pas de directeur SF");
						return;
					}

					// Etape N°1
					var encadrementEtape1 = Math.ceil(nbJeunes / 12);
					var effectifEtape1 = effectifTotal;
					var deltaEtape1 = effectifEtape1 - encadrementEtape1;
					if (deltaEtape1 < 0) {
						afficheResultat(false, "Encadrement \"1 chef pour 12 jeunes\" insuffisant");
						return;
					}

					// Etape N°2
					var encadrementEtape2 = Math.ceil(effectifTotal * 0.5 / 12);
					var effectifEtape2 = parseInt(nbDirecteurs, 10) + parseInt(nbDirecteursStagiaire, 10) + parseInt(nbAnimateurs, 10) + parseInt(nbAnimateursStagiaire, 10);
					var deltaEtape2 = effectifEtape2 - encadrementEtape2;
					if (deltaEtape2 < 0) {
						afficheResultat(false, "Encadrement \"par rapport au minimum d'animateurs : 50% titulaire\" insuffisant");
						return;
					}

					// Etape N°2 bis
					if (effectifTotal <= encadrementEtape1) {
						var encadrementEtape3 = effectifTotal * 0.2;
						var effectifEtape3 = parseInt(nbNonQualifies, 10);
						if (effectifTotal == 3 || effectifTotal == 4) {
							if (nbNonQualifies > 0)
								encadrementEtape3 = 1;
						}
						var deltaEtape3 = encadrementEtape3 - effectifEtape3;
						if (deltaEtape3 < 0) {
							afficheResultat(false, "Encadrement \"par rapport au minimum d'animateurs : 80% titulaire ou stagiaire\" insuffisant");
							return;
						}
					}
				}
				else {
					// Calcul pour les autres unites
					var deltaDirSF = parseInt(nbDirecteurs, 10) + parseInt(nbDirecteursStagiaire, 10) - 1;
					if (deltaDirSF < 0) {
						afficheResultat(false, "Pas de directeur SF");
						return;
					}

					// Etape N°1
					var encadrementEtape1 = Math.ceil(nbJeunes / 12) + 1;
					var effectifEtape1 = effectifTotal;
					var deltaEtape1 = effectifEtape1 - encadrementEtape1;
					if (deltaEtape1 < 0) {
						afficheResultat(false, "Encadrement \"1 chef pour 12 jeunes plus directeur\" insuffisant");
						return;
					}

					// Etape N°2
					var encadrementEtape2 = Math.ceil(effectifTotal * 0.5 / 12) + 1;
					var effectifEtape2 = parseInt(nbDirecteurs, 10) + parseInt(nbDirecteursStagiaire, 10) + parseInt(nbAnimateurs, 10) + parseInt(nbAnimateursStagiaire, 10);
					var deltaEtape2 = effectifEtape2 - encadrementEtape2;
					if (deltaEtape2 < 0) {
						afficheResultat(false, "Encadrement \"par rapport au minimum d'animateurs : 50% titulaire + 1 dir titulaire\" insuffisant");
						return;
					}

					// Etape N°2 bis
					if (effectifTotal <= encadrementEtape1) {
						var encadrementEtape3 = effectifTotal * 0.2;
						var effectifEtape3 = parseInt(nbNonQualifies, 10);
						if (effectifTotal == 3 || effectifTotal == 4) {
							if (nbNonQualifies > 0)
								encadrementEtape3 = 1;
						}
						var deltaEtape3 = encadrementEtape3 - effectifEtape3;
						if (deltaEtape3 < 0) {
							afficheResultat(false, "Encadrement \"par rapport au minimum d'animateurs : 80% titulaire ou stagiaire + 1 dir titulaire\" insuffisant");
							return;
						}
					}
				}
				afficheResultat(true, "");
			}
		}
	</script>

	<h4>Calculateur du taux d’encadrement</h4>
	<h5>(bas&eacute; sur le Guide R&eacute;glementaire du Scoutisme Fran&ccedil;ais <a
			href="https://www.scoutisme-francais.fr/formation">lien)</a></h5>
	<form id="FormQuotas" action="(EmptyReference!)" method="post" name="FormQuotas">
		<fieldset>
			<legend>Unité</legend><input type="radio" name="radioUnite" value="radioLouveteauxJeannettes"
				onclick="calculQuotas();" checked="checked" />Louveteaux / Jeannettes <input type="radio"
				name="radioUnite" onclick="calculQuotas();" value="radioScoutsGuides" />Scouts / Guides <input
				type="radio" name="radioUnite" onclick="calculQuotas();" value="radioPionniersCaravelles" />Pionniers
			/ Caravelles
			<p><label>Nb de jeunes :</label><input type="text" name="textfieldJeunes" value="0" size="5"
					onkeyup="calculQuotas();" /></p>
		</fieldset>
		<fieldset>
			<legend>Qualifications</legend>
			<table width="100%" border="0" cellspacing="2" cellpadding="0">
				<tr>
					<td width="61%"><label>Directeur SF titulaire</label></td>
					<td align="right"><input type="text" name="textfieldDirecteursSF" value="0" size="2"
							onkeyup="calculQuotas();" /></td>
				</tr>
				<tr>
					<td width="61%"><label>Directeur SF stagiaire</label></td>
					<td align="right"><input type="text" name="textfieldDirecteursSFstagiaire" value="0" size="2"
							onkeyup="calculQuotas();" /></td>
				</tr>
				<tr>
					<td width="61%">Animateur SF titulaire</label></td>
					<td align="right"><input type="text" name="textfieldAnimateursSF" value="0" size="2"
							onkeyup="calculQuotas();" /></td>
				</tr>
				<tr>
					<td width="61%">Animateur SF stagiaire</label></td>
					<td align="right"><input type="text" name="textfieldAnimateursSFstagiaire" value="0" size="2"
							onkeyup="calculQuotas();" /></td>
				</tr>
				<tr>
					<td width="61%"><label>Sans qualification</label></td>
					<td align="right"><input type="text" name="textfieldNonQualifies" value="0" size="2"
							onkeyup="calculQuotas();" /></td>
				</tr>
			</table>
		</fieldset>
		<fieldset>
			<legend>Résultat</legend>
			<table width="100%" border="0" cellspacing="2" cellpadding="0">
				<tr>
					<td width="41%"><label>Résultat du calcul :</label></td>
					<td><input style="width:100%" type="text" name="labelResultat" readonly="readonly" size="20" /></td>
				</tr>
				<tr>
					<td width="41%"><label>Détails :</label></td>
					<td><textarea style="width:100%;padding:1px" name="labelDetail" rows="4" cols="40" disabled="disabled"
							readonly="readonly"></textarea></td>
				</tr>
			</table>
		</fieldset>
	</form>
	<h6>Version 1.0.0</h6>
	<script type="text/javascript">
		calculQuotas();
	</script>
</body>

</html>